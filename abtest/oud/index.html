<!DOCTYPE html>
<!-- saved from url=(0049)http://demo.edriessen.nl/d3-donut-reuse-function/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
        <link rel="stylesheet" title="stylesheet" type="text/css" href="./src/style.css" media="all">
        <script type="text/javascript" src="./src/d3.js"></script>
        <script type="text/javascript" src="./src/jquery-2.0.3.min.js"></script>
        <style type="text/css"></style>
    </head>
    <body>
    <div id="donut1" class="donut"></div>
    <div id="donut2" class="donut"></div>

        <script type="text/javascript">
        var dataA = [];
            dataB = [];
            
        d3.csv("dataset_abtest.csv", function(loadedRows) {
          rows = loadedRows;
          handleLoadedRows();
        })
        
         function handleLoadedRows() {
            $.each(rows, function(i,item){
                if (item.Version == "A") dataA.push(parseFloat(item.Conversies));
                if (item.Version == "B") dataB.push(parseFloat(item.Conversies));
            });
        makeDonut('#donut1', dataA, 200, 100, 40);
        makeDonut('#donut2', dataB, 200, 100, 40);
        }

        
        function makeDonut(container, dataSet, size, radius, innerRadius){
        var w = size,
            h = size,
            r = radius,
            ir = innerRadius,
            color = d3.scale.category20c().domain([22, 162]).range(["#aaa", "#FB9A63"]),
            donut = d3.layout.pie().sort(null),
            arc = d3.svg.arc().innerRadius(ir).outerRadius(r);
          
        var depthColors = d3.scale.linear()
            .domain([d3.min(dataSet),d3.max(dataSet)])
            .range(["#fff", "#ff0000"]);
        
        var svg = d3.select(container).append("svg:svg")
            .attr("width", w)
            .attr("height", h)
          .append("svg:g")
            .attr("transform", "translate(" + w / 2 + "," + h / 2 + ")");
        
        var arcs = svg.selectAll("path")
            .data(donut(dataSet))
              .enter().append("svg:path")
                .attr("fill", function(d, i) { return depthColors(d.value); })
                .attr("d", arc)
                .each(function(d) { this._current = d; });
        }


            </script>
          
    
</body></html>